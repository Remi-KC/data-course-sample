# Week1 實作「rule-based」的推薦系統
### 一、專案目的：
根據使用者過去的購買行為與商品資訊，打造一個美妝商品推薦系統。
### 二、使用工具：
1. 資料：來自 2014 年 Amazon 發布的資料集
    * 購買記錄_美妝類：2000-01-10 - 2018-10-02 (共 371345 筆)
      * 訓練資料：2000-01-10 - 2018-09-01 (共 370752 筆)
      * 測試資料：2018-09-01 - 2018-09-30 (共 590 筆)
    * 商品資訊_美妝類：共 32892 個商品
2. 程式語言：Python
### 三、推薦方法：
* 規則一：依據使用者過去的購買紀錄，推薦「買過這個商品的人也購買...」之個人化商品清單，並依照 推薦次數->銷量->商品評價 排序清單。
* 規則二：依照商品指標分數，推薦分數高的商品，指標排序：支持度->銷量->評價。
* 整合方式：依照規則一推薦至多5項商品，然後以規則二推薦滿10項商品。
### 四、推薦結果：
* 評估分數：Recall = 0.0830508
* 註1：對於本測試資料，規則一沒有產生預期效果，可能是因為只有3位目標客戶使用到這份個人化清單。
* 註2：測試資料中，只有 0.01% 的使用者也存在訓練資料中，很可能因此讓運用歷史資料產生的個人化推薦清單沒有明顯效果。
# Week2 實作「Content-based Filtering」的推薦系統
### 一、專案目的：
根據使用者過去的購買行為與商品資訊，實作一個內容過濾推薦系統。
### 二、使用工具：
1. 資料：來自 2014 年 Amazon 發布的資料集
   * 購買記錄_美妝類：2000-01-10 - 2018-10-02 (共 371345 筆)
      * 訓練資料：2018-08-01 - 2018-08-31 (共 1662 筆) 
         * 註：經過上次同學的分享，本次訓練資料只選用最近一個月的資料。
      * 測試資料：2018-09-01 - 2018-09-30 (共 590 筆)
   * 商品資訊_美妝類：共 32892 個商品
2. 程式語言：Python
### 三、資料整理：
1. 利用 rank 中的類別資訊，刪除非美妝類產品，並刪除重複項。
2. 轉換 rank 和 price 資料成數字。
3. 產生舊戶名單
4. 合併「前一個月被購買過的商品」＋「舊客戶購買過的商品(51筆)」，製作後續想比較的商品列表 ，共866項商品。再加入處理後的商品資訊'title','rank','price'，刪除有缺失值的品項後，最後共計納入632項產品。
5. 計算每件商品的「購買數(評論數)」和「平均評價」，並將資訊加入商品列表中。
### 四、資料探索與特徵選擇：
1. 探索目的：篩選特徵
2. 探索邏輯：想選出某些特徵是「商品如果在這些特徵越相近，購買數/評論數也會越接近」。背後的想法是認為：賣得好的商品，有些特徵會很像，同理，賣得不好的產品也是。而購買數/評論數是對推薦結果最有預測力的指標，所以想看特徵跟它的關聯性。
3. 方法：計算特徵相似度後，和購買數/評論數相似度（Euclidean distance）計算相關值，看有沒有顯著。
4. 特徵：品名(title)、銷售排行(rank)、價錢(price)、評價(overall)、品牌(brand)
   * 註：檢定部分採用Mantel test。
5. 分析小結（特徵選擇）：
   1. 評價：評價相似度和購買數相似度無關，而且評價和銷售、購買數都沒有多大關係。決定不處理這個特徵，也不刪掉評價低的商品。
   2. 品牌( One Hot Encoding)：品牌相似度和購買數相似度無關，所以不處理這個特徵。
   3. 品名、銷售排行、價錢：這三個特徵的相似度都和購買數相似度有顯著相關，因此三個特徵都會納入評估商品相似度。
   4. 特徵組合想法：
      1. 品名+銷售排行+價錢
      2. 銷售排行+價錢（這個組合的相關顯著性>第1組）
      3. 品名 推薦兩個，其他都推 銷售排行+價錢（這個想法我後來沒有試，理論上效果不如第2組）
### 五、推薦規則與結果：
1. 舊戶-方法一：Recall = 0.02564
   * 特徵選擇：品名、價錢、銷售排行。
   * 說明：只針對舊客戶，依據過去購買商品推薦相似的產品。
   * 目的：不考慮新客戶是為了評估單純只用內容推薦的成效。
   * 反思：分數很不理想，比上週只用規則推薦的效果還差。可能因為38位客戶中有高達14位沒有商品能推薦。猜測可能是使用的商品特徵不足，或者顧客過去購買的商品非常冷門造成。
   <br/> 
2. 舊戶-方法二：Recall = 0.05128
   * 特徵選擇：價錢、銷售排行。
   * 說明：一樣只針對舊客戶，依據過去購買商品推薦相似的產品，但將品名特徵剔除。
   * 目的：分析中發現這個特徵組合的相關顯著性比較高，所以試試看推薦效果有沒有比上一個好。
   * 反思：比「舊戶-方法一」好一點，符合資料探索的預期，加入「品名」特徵反而降低推薦成效。但仍然比上週只用規則推薦的效果還差。問題點同上。不過相較於上週使用also_buy資料根本0效果，這次純粹內容推薦的部分有抓到比較多對的商品。
   <br/> 
3. 全部客戶-方法一：Recall = 0.15254
   * 特徵選擇：品名、價錢、銷售排行。
   * 說明：針對舊客戶採取內容推薦，新客戶採取規則推薦（近一個月Top10購買商品）。當舊客戶的內容推薦量不足時，以規則推薦補足10項。
   * 目的：觀察加上規則推薦後能提升多少效果。
   * 反思：效果一下提升滿多的，但主因應該是規則推薦的部分相較上週優化了。
   <br/> 
4. 全部客戶-方法二：Recall = 0.15423
   * 特徵選擇：價錢、銷售排行。
   * 說明：同上。
   * 目的：觀察剔除品名特徵後的效果提升多少。
   * 反思：去掉 品名 特徵後，成效微微提升，差異不大。應該是因為用到內容推薦的人數比例過少，所以這個調整看不太到效果。
   <br/> 
# Week3 實作「Collaborative filtering」的推薦系統
### 一、專案目的：
根據使用者過去的購買行為與商品資訊，實作三種協同過濾推薦系統。
### 二、使用工具：（同第二週）
### 三、資料整理：
1. 利用 rank 中的類別資訊，刪除非美妝類產品，並刪除重複項。
2. 轉換 rank 和 price 資料成數字。
3. 產生舊戶名單
4. 處理文字欄位
5. 合併「前一個月被購買過的商品」＋「舊客戶購買過的商品(51筆)」，製作後續想比較的商品列表 ，共866項商品。再加入處理後的商品資訊'title','rank','price'，刪除有缺失值的品項後，最後共計納入632項產品(刪除了27%)。
6. 計算每件商品的「購買數(評論數)」和「平均評價」，並將資訊加入商品列表中。
### 四、資料探索：
#### （一） 與協同過濾相關的探索分析：
1. 評價分佈情形：
   * 5星好評佔6成，大部分被購買商品的評價都很好。
   * 評價長期的分佈情形和短期的分佈情形近乎相同，平台商品口碑穩定。
2. 商品價格分佈情形：
   * 有購買記錄的商品價格分佈，看起來和全部產品的價格分佈相同，暗示幾乎每件商品都被買過，計算發現只有6件商品沒有銷售紀錄。
   * 多數被購買的商品<30元，可以考慮讓推薦系統過濾掉價格超過30元的商品。
   * 有567種被購買的商品不在商品清單裡(佔購買商品1.74%)：
3. 探索重疊性：
   * 9成使用者只給過一次評價。
   * 4成以上的商品只得到1次評價。
   * 可以考慮設定（商品/用戶）評價數min=2或3
4. KNN校正考量：
   * 不論是有無過濾評論數的資料，一半以上的使用者給分偏高，集中在5分。因為個體差異不大，預期校正Mean不會有太大差別。
   * 40-50%的商品平均分數集中在5分，預期校正Mean不會有太大差別。
   * 高達6、7成的使用者評分標準差為0，標準化可能沒有差異。
   * 25-35%的商品評價標準差集中在0，分佈的集中情形沒有以上三種那麼明顯，不確定標準化的影響。 
#### （二）冷啟動問題探索：
冷啟動問題有很多處理方法，其中一種是透過尋找代表性用戶來預測新客戶的行為，雖然一般會有更多資料輔助（例如讓用戶選填幾個與偏好有關的簡單問題，或利用連結的個人社群網站資料等等），但我想就目前有的資料找找看新用戶之間有沒有什麼共通的行為，看能不能作為代表性資料用在協同過濾上。
1. 新用戶購買的商品重疊率如何？（有哪些商品是新用戶都會買的嗎）
   * 以月份切分發現，任兩個月之間，新用戶購買的商品有20%左右是相同的。
2. 這些重疊的商品是相同的嗎？
   * 發現雖然重疊比率類似，但並不是相同商品，重疊的商品項目會隨著時間變化。
3. 新用戶對共同購買商品的評價雷同嗎？---以2018年8月的新戶購買資料和2018年7、5、2月、2017年9月的新戶購買資料相比
   * 新戶對共同商品有類似的評價，相關值都在.2上下，但顯著。
   * 任兩個月之間重疊的購買商品數都在330項上下。
4. 後續嘗試把這樣的關聯用在推薦系統上，將測試樣本的新戶ID隨機配對至2018年8月和7月購買了共通商品的新戶ID，作為新的訓練集，實驗新的演算法。
#### （三）特徵選擇：
延續上週未嘗試的部分，將'discription'欄位與'title'和'brand'合併，成為商品文字描述特徵。
1. 品牌：將資料清得更乾淨後，品牌相似度仍然和購買數相似度無關，所以不以One Hot Encoding處理這個特徵。
文字描述、銷售排行、價錢：這三個特徵的相似度都和購買數相似度有顯著相關，因此三個特徵都會納入評估商品相似度。
2. 測試組合：
   * 文字描述+銷售排行+價錢（相關較顯著）
   * 只用 文字描述 （相關值較高）
### 五、推薦規則與結果：
1. User-based collaborative filtering：
   * 原演算法：Recall = 0.0
   * 新演算法：Recall = 0.0542
2. Item -based collaborative filtering：
   * 原演算法：Recall = 0.0
   * 新演算法：Recall = 0.0322
3. surprise_collaborative filtering：
   * 原演算法：Recall = 0.0033
   * 新演算法：Recall = 0.0576
4. KNN校正：與探索結果相符，和不校正的結果相同，無校正需要。
5. 三種協同過濾結果反思：
   * 以surprise套件配合新演算法的表現最好，猜測是因為運用到的資料量比較大（用過濾評論數較少的訓練集recall也變成0）。感受到協同過濾對資料量的依賴性。
   * User-based在新演算法上的效果優於Item-based，可能因為這個算法的產生是建立在尋找代表性「用戶」之上。
   * 從演算法實驗看到協同過濾有多仰賴資料重疊性。
6. Content-based結果反思：Recall = 0.0
比上週只用title做內容推薦的效果還差。可能description裡面的資料質量很差所以效果反而更糟，所以資料量不是越多越好。而做特徵選擇的時候相關分析顯著或許只是因為資料量很大。

